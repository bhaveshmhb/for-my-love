<script>
document.addEventListener("DOMContentLoaded",()=>{

/* ========== OPENING SEQUENCE ========== */

setTimeout(()=>{
document.getElementById("bg").style.opacity=1;
},3500);

setTimeout(()=>{
document.getElementById("reveal").remove();
startStory();
},8500);

const lines=[
"Hello CutieeğŸ¥°",
"Today is OUR first valentine",
"Long distance really sucksğŸ¥²ğŸ«‚",
"I made this for you",
"To make our first valentine specialğŸ˜"
];

const story=document.getElementById("story");
const dim=document.getElementById("dim");
let index=0;

function showSlides(){

story.classList.remove("slideIn","slideOut");

story.textContent=lines[index];

requestAnimationFrame(()=>{
story.classList.add("slideIn");
});

setTimeout(()=>{

story.classList.remove("slideIn");
story.classList.add("slideOut");

setTimeout(()=>{

index++;

if(index >= lines.length){
dim.classList.remove("show");
createSideCard();
return;
}

showSlides();

},1500);

},3800);
}


function startStory(){
setTimeout(()=>{
dim.classList.add("show");
setTimeout(showSlides,2000);
},700);
}

/* ========== SIDE CARD ========== */

function createSideCard(){
const card=document.createElement("div");
card.id="sideCard";
card.innerHTML=`
<div class="cardContent">
   <div id="cardInner">
      <button id="hugBtn">Hold here to hug me tightly ğŸ«‚</button>
   </div>
</div>
`;

document.body.appendChild(card);
requestAnimationFrame(()=>{
card.classList.add("show");
});
}

/* ========== STARS ========== */

for(let i=0;i<60;i++){
let s=document.createElement("div");
s.className="star";
s.style.left=Math.random()*100+"vw";
s.style.top=Math.random()*100+"vh";
s.style.animationDelay=Math.random()*2+"s";
document.body.appendChild(s);
}

/* ========== HUG BUTTON ========== */

let holdInterval=null;
let activeBtn=null;
const HOLD_TIME=2600;

document.addEventListener("pointerdown",(e)=>{
const btn=e.target.closest("#hugBtn");
if(!btn) return;

activeBtn=btn;
const rect=btn.getBoundingClientRect();
const x=((e.clientX-rect.left)/rect.width)*100;
const y=((e.clientY-rect.top)/rect.height)*100;

btn.style.setProperty("--x",x+"%");
btn.style.setProperty("--y",y+"%");
btn.style.setProperty("--hold","0");

let start=performance.now();

holdInterval=setInterval(()=>{
let progress=(performance.now()-start)/HOLD_TIME;
if(progress>1) progress=1;

btn.style.setProperty("--hold",progress.toFixed(3));

if(progress>=1){
clearInterval(holdInterval);
activeBtn=null;
hugComplete(btn);
}
},16);
});

document.addEventListener("pointerup",cancelHold);
document.addEventListener("pointercancel",cancelHold);

function cancelHold(){
if(!activeBtn) return;
clearInterval(holdInterval);
activeBtn.style.transition="--hold .3s ease";
activeBtn.style.setProperty("--hold","0");
setTimeout(()=>{
if(activeBtn) activeBtn.style.transition="";
activeBtn=null;
},300);
}

function hugComplete(btn){
btn.style.setProperty("--hold","1");

for(let i=0;i<12;i++){

const heart=document.createElement("div");
heart.className="heartPop";
heart.textContent=["ğŸ’—","ğŸ’–","ğŸ’•","â¤ï¸"][Math.floor(Math.random()*4)];

const rect=btn.getBoundingClientRect();

const angle=Math.random()*Math.PI*2;
const distance=40+Math.random()*80;

heart.style.left=(rect.left+rect.width/2 + Math.cos(angle)*distance)+"px";
heart.style.top=(rect.top+rect.height/2 + Math.sin(angle)*distance)+"px";
heart.style.fontSize=(22+Math.random()*18)+"px";

document.body.appendChild(heart);
setTimeout(()=>heart.remove(),900);
}

const card = btn.closest(".cardContent");

setTimeout(()=>{
card.classList.add("identityMode");
},250);

setTimeout(()=>{
expandCard(card);

setTimeout(()=>{
document.getElementById("quizBox").style.opacity=1;
},80);

},950);

}

/* ========== QUIZ ========== */

function expandCard(card){
document.getElementById("cardInner").innerHTML=
`
<div id="quizBox" style="opacity:0; transition:opacity .8s ease;">
<div class="quizHeader">
<div class="quizTitle">Prove that you're my Babyy ğŸ¥ºâ¤ï¸</div>
<div class="divider"></div>
</div>
<div class="quizCenter">
<div id="questionText" class="question"></div>
<input id="answerInput" type="text" placeholder="type your answer..." autocomplete="off">
<button id="submitBtn">Send ğŸ’Œ</button>
<div id="responseText" class="response"></div>
</div>
</div>
`;
startQuiz();
}

const quiz=[
{
question:"What name did you save me as in your phone?",
answers:["baby","babyy","my baby"],
correct:"ğŸ’— hehe correct",
wrong:"nope try again ğŸ˜Œ"
},
{
question:"What do you call me when it's just us?",
answers:["cutie","love","idiot"],
correct:"i like that one ğŸ¤­",
wrong:"hmmm not that"
},
{
question:"What always makes me happiest?",
answers:["hug","kiss","talk","call"],
correct:"exactly â¤ï¸",
wrong:"almost... think again"
}
];

let qIndex=0;

function startQuiz(){
showQuestion();
}

function showQuestion(){
const q=quiz[qIndex];
const qBox=document.getElementById("questionText");
const input=document.getElementById("answerInput");
const response=document.getElementById("responseText");

response.textContent="";
input.value="";
qBox.classList.remove("show");
qBox.textContent=q.question;

setTimeout(()=>{
qBox.classList.add("show");
input.focus();
},120);
}

document.addEventListener("click",(e)=>{
if(e.target.matches("#submitBtn")){
checkAnswer();
}
});

document.addEventListener("keydown",(e)=>{
if(e.key==="Enter" && document.activeElement.id==="answerInput"){
const btn=document.getElementById("submitBtn");
if(btn) btn.click();
}
});


function checkAnswer(){
const input=document.getElementById("answerInput");
if(!input) return;

const user=input.value.toLowerCase().trim();
const q=quiz[qIndex];
const response=document.getElementById("responseText");
const correct=q.answers.some(a=>user.includes(a));

if(correct){
response.textContent=q.correct;
response.style.color="#ffb3da";

setTimeout(()=>{
qIndex++;
if(qIndex<quiz.length){
showQuestion();
}else{
quizComplete();
}
},900);
}else{
response.textContent=q.wrong;
response.style.color="#ffd6ec";
}
}

/* ========== QUIZ COMPLETE â†’ MESSAGES â†’ HEART ENTRY ========== */

function quizComplete(){
const card=document.querySelector(".cardContent");
const inner=document.getElementById("cardInner");

// Message 1
inner.innerHTML=`
<div class="finalOpen fadeText" style="font-family:'Dancing Script',cursive;font-size:42px;line-height:1.4;">
Yayy finally ğŸ’—<br>
You proved that you're my babyy
</div>`;

requestAnimationFrame(()=>{
inner.querySelector(".fadeText").classList.add("show");
});

// Message 2 after 2.5s
setTimeout(()=>{
inner.querySelector(".fadeText").classList.remove("show");

setTimeout(()=>{

inner.innerHTML=`
<div class="heartMessage">
Comeâ€¦<br>
we're going inside my heart ğŸ’—
</div>
`;

// Start portal after 2.5 seconds
setTimeout(()=>{
// HIDE THE TEXT IMMEDIATELY
inner.style.opacity = "0";
inner.style.transition = "opacity 0.6s ease";

// Start portal after text fades
setTimeout(()=>{
enterHeartWorld(card);
},600);

},2500);

},1300);
},2500);
}

function enterHeartWorld(card){

// Get card's exact position
const rect = card.getBoundingClientRect();

// Freeze card exactly where it is
card.style.position = "fixed";
card.style.top = rect.top + "px";
card.style.left = rect.left + "px";
card.style.width = rect.width + "px";
card.style.height = rect.height + "px";
card.style.transform = "none";
card.style.margin = "0";
card.parentElement.style.pointerEvents = "none";

// Clear the inner content (remove text)
document.getElementById("cardInner").innerHTML = "";

// Create pink glow overlay FROM EDGES
const pinkOverlay = document.createElement("div");
pinkOverlay.style.cssText = `
position: fixed;
inset: 0;
background: radial-gradient(circle at 50% 50%, 
transparent 0%, 
rgba(255, 182, 230, 0.3) 30%,
rgba(255, 150, 200, 0.6) 60%,
rgba(255, 120, 180, 0.9) 100%);
opacity: 0;
z-index: 998;
pointer-events: none;
transition: opacity 2s ease;
`;
document.body.appendChild(pinkOverlay);

// Start pink glow from edges
setTimeout(()=>{
pinkOverlay.style.opacity = "1";
},50);

// Start card expansion with transition
card.style.transition = "all 4s cubic-bezier(0.22, 1, 0.36, 1)";
card.style.background = "linear-gradient(180deg, #ffd9f0, #ffc3ea, #ffb3e6)";
card.style.backdropFilter = "none";
card.style.webkitBackdropFilter = "none";
card.style.boxShadow = "0 0 120px rgba(255, 150, 220, 0.9)";

// Trigger expansion
requestAnimationFrame(()=>{
requestAnimationFrame(()=>{
card.style.width = "100vw";
card.style.height = "100vh";
card.style.top = "0";
card.style.left = "0";
card.style.borderRadius = "0";
});
});

// Fade old world during expansion
setTimeout(()=>{
document.getElementById("bg")?.classList.add("fadeOldWorld");
document.getElementById("dim")?.classList.add("fadeOldWorld");
document.querySelectorAll(".star").forEach(s=>s.classList.add("fadeOldWorld"));
},1000);

// After expansion completes (4 seconds)
setTimeout(()=>{

// Hold pink for 1 second, then fade to reveal sky
setTimeout(()=>{

// Fade pink overlay out
pinkOverlay.style.transition = "opacity 2s ease";
pinkOverlay.style.opacity = "0";

// Fade card out
card.style.transition = "opacity 2s ease";
card.style.opacity = "0";

// Show heart world
document.getElementById("heartWorld").classList.add("show");

// Remove pink overlay after fade
setTimeout(()=>{
pinkOverlay.remove();
card.remove();
},2000);

},1000); // Hold for 1 second

},4000); // Wait for expansion to complete

}

});

</script>
